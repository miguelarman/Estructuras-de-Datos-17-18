{"filter":false,"title":"sale.c","tooltip":"/sale.c","ace":{"folds":[],"scrolltop":1690,"scrollleft":0,"selection":{"start":{"row":191,"column":0},"end":{"row":191,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":109,"state":"start","mode":"ace/mode/c_cpp"}},"hash":"2790fd1649957b4d6fa000e4d2ee91372ad3d592","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":80,"column":5},"end":{"row":81,"column":0},"action":"remove","lines":["",""],"id":217,"ignore":true}],[{"start":{"row":89,"column":25},"end":{"row":89,"column":26},"action":"remove","lines":["2"],"id":218,"ignore":true},{"start":{"row":89,"column":25},"end":{"row":89,"column":26},"action":"insert","lines":["1"]}],[{"start":{"row":95,"column":25},"end":{"row":95,"column":26},"action":"remove","lines":["2"],"id":219,"ignore":true},{"start":{"row":95,"column":25},"end":{"row":95,"column":26},"action":"insert","lines":["1"]}],[{"start":{"row":101,"column":25},"end":{"row":101,"column":26},"action":"remove","lines":["2"],"id":220,"ignore":true},{"start":{"row":101,"column":25},"end":{"row":101,"column":26},"action":"insert","lines":["1"]}],[{"start":{"row":102,"column":4},"end":{"row":102,"column":6},"action":"remove","lines":["/*"],"id":221,"ignore":true}],[{"start":{"row":108,"column":0},"end":{"row":108,"column":4},"action":"remove","lines":["    "],"id":222,"ignore":true}],[{"start":{"row":107,"column":5},"end":{"row":107,"column":7},"action":"remove","lines":["*/"],"id":223,"ignore":true}],[{"start":{"row":101,"column":25},"end":{"row":101,"column":26},"action":"remove","lines":["1"],"id":224,"ignore":true},{"start":{"row":101,"column":25},"end":{"row":101,"column":26},"action":"insert","lines":["1"]}],[{"start":{"row":101,"column":25},"end":{"row":101,"column":26},"action":"remove","lines":["1"],"id":225,"ignore":true},{"start":{"row":101,"column":25},"end":{"row":101,"column":26},"action":"insert","lines":["2"]}],[{"start":{"row":95,"column":25},"end":{"row":95,"column":26},"action":"remove","lines":["1"],"id":226,"ignore":true},{"start":{"row":95,"column":25},"end":{"row":95,"column":26},"action":"insert","lines":["2"]}],[{"start":{"row":89,"column":25},"end":{"row":89,"column":26},"action":"remove","lines":["1"],"id":227,"ignore":true},{"start":{"row":89,"column":25},"end":{"row":89,"column":26},"action":"insert","lines":["2"]}],[{"start":{"row":23,"column":4},"end":{"row":23,"column":6},"action":"insert","lines":["/*"],"id":228,"ignore":true},{"start":{"row":24,"column":37},"end":{"row":24,"column":39},"action":"insert","lines":["*/"]}],[{"start":{"row":82,"column":4},"end":{"row":83,"column":4},"action":"insert","lines":["","    "],"id":229,"ignore":true}],[{"start":{"row":83,"column":4},"end":{"row":94,"column":4},"action":"insert","lines":["","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    "],"id":230,"ignore":true}],[{"start":{"row":94,"column":4},"end":{"row":107,"column":4},"action":"insert","lines":["","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    "],"id":231,"ignore":true}],[{"start":{"row":88,"column":4},"end":{"row":98,"column":5},"action":"insert","lines":["ret = SQLFreeHandle(SQL_HANDLE_STMT, stmt3);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error freeing stmt3\");","        return EXIT_FAILURE;","    }","","    /* DISCONNECT */","    ret = odbc_disconnect(env, dbc);","    if (!SQL_SUCCEEDED(ret)) {","        return EXIT_FAILURE;","    }"],"id":232,"ignore":true}],[{"start":{"row":88,"column":45},"end":{"row":88,"column":46},"action":"remove","lines":["3"],"id":233,"ignore":true},{"start":{"row":88,"column":45},"end":{"row":88,"column":46},"action":"insert","lines":["1"]}],[{"start":{"row":105,"column":4},"end":{"row":110,"column":5},"action":"insert","lines":["ret = odbc_connect(&env2, &dbc2);","    ret = odbc_connect(&env3, &dbc3);*/","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error conecting\");","        return EXIT_FAILURE;","    }"],"id":234,"ignore":true}],[{"start":{"row":106,"column":0},"end":{"row":107,"column":0},"action":"remove","lines":["    ret = odbc_connect(&env3, &dbc3);*/",""],"id":235,"ignore":true}],[{"start":{"row":112,"column":4},"end":{"row":118,"column":5},"action":"insert","lines":["ret = SQLAllocHandle(SQL_HANDLE_STMT, dbc2, &stmt2);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error allocating stmt2\");","                odbc_extract_error(\"SQLDriverConnect\", dbc, SQL_HANDLE_DBC);","","        return EXIT_FAILURE;","    }"],"id":236,"ignore":true}],[{"start":{"row":38,"column":4},"end":{"row":38,"column":6},"action":"insert","lines":["/*"],"id":237,"ignore":true},{"start":{"row":51,"column":5},"end":{"row":51,"column":7},"action":"insert","lines":["*/"]}],[{"start":{"row":105,"column":27},"end":{"row":105,"column":28},"action":"remove","lines":["2"],"id":238,"ignore":true}],[{"start":{"row":38,"column":4},"end":{"row":38,"column":6},"action":"remove","lines":["/*"],"id":239,"ignore":true},{"start":{"row":51,"column":5},"end":{"row":51,"column":7},"action":"remove","lines":["*/"]},{"start":{"row":87,"column":4},"end":{"row":118,"column":5},"action":"remove","lines":["","    ret = SQLFreeHandle(SQL_HANDLE_STMT, stmt1);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error freeing stmt3\");","        return EXIT_FAILURE;","    }","","    /* DISCONNECT */","    ret = odbc_disconnect(env, dbc);","    if (!SQL_SUCCEEDED(ret)) {","        return EXIT_FAILURE;","    }","    ","    ","    ","    ","    ","    ","    ret = odbc_connect(&env, &dbc2);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error conecting\");","        return EXIT_FAILURE;","    }","    ","    ","    ret = SQLAllocHandle(SQL_HANDLE_STMT, dbc2, &stmt2);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error allocating stmt2\");","                odbc_extract_error(\"SQLDriverConnect\", dbc, SQL_HANDLE_DBC);","","        return EXIT_FAILURE;","    }"]}],[{"start":{"row":103,"column":84},"end":{"row":103,"column":85},"action":"insert","lines":[" "],"id":240}],[{"start":{"row":103,"column":85},"end":{"row":103,"column":86},"action":"insert","lines":["l"],"id":241}],[{"start":{"row":103,"column":86},"end":{"row":103,"column":87},"action":"insert","lines":["i"],"id":242}],[{"start":{"row":103,"column":87},"end":{"row":103,"column":88},"action":"insert","lines":["m"],"id":243}],[{"start":{"row":103,"column":88},"end":{"row":103,"column":89},"action":"insert","lines":["i"],"id":244}],[{"start":{"row":103,"column":89},"end":{"row":103,"column":90},"action":"insert","lines":["t"],"id":245}],[{"start":{"row":103,"column":90},"end":{"row":103,"column":91},"action":"insert","lines":[" "],"id":246}],[{"start":{"row":103,"column":91},"end":{"row":103,"column":92},"action":"insert","lines":["1"],"id":247}],[{"start":{"row":103,"column":91},"end":{"row":103,"column":92},"action":"remove","lines":["1"],"id":248}],[{"start":{"row":103,"column":90},"end":{"row":103,"column":91},"action":"remove","lines":[" "],"id":249}],[{"start":{"row":103,"column":89},"end":{"row":103,"column":90},"action":"remove","lines":["t"],"id":250}],[{"start":{"row":103,"column":88},"end":{"row":103,"column":89},"action":"remove","lines":["i"],"id":251}],[{"start":{"row":103,"column":87},"end":{"row":103,"column":88},"action":"remove","lines":["m"],"id":252}],[{"start":{"row":103,"column":86},"end":{"row":103,"column":87},"action":"remove","lines":["i"],"id":253}],[{"start":{"row":103,"column":85},"end":{"row":103,"column":86},"action":"remove","lines":["l"],"id":254}],[{"start":{"row":103,"column":84},"end":{"row":103,"column":85},"action":"remove","lines":[" "],"id":255}],[{"start":{"row":23,"column":4},"end":{"row":23,"column":6},"action":"remove","lines":["/*"],"id":256,"ignore":true}],[{"start":{"row":24,"column":37},"end":{"row":24,"column":39},"action":"remove","lines":["*/"],"id":257,"ignore":true}],[{"start":{"row":84,"column":4},"end":{"row":84,"column":17},"action":"insert","lines":["closeCursor()"],"id":258,"ignore":true}],[{"start":{"row":84,"column":16},"end":{"row":84,"column":19},"action":"insert","lines":["stm"],"id":259,"ignore":true}],[{"start":{"row":84,"column":19},"end":{"row":84,"column":21},"action":"insert","lines":["t1"],"id":260,"ignore":true},{"start":{"row":84,"column":22},"end":{"row":84,"column":23},"action":"insert","lines":[","]}],[{"start":{"row":84,"column":22},"end":{"row":84,"column":23},"action":"remove","lines":[","],"id":261,"ignore":true},{"start":{"row":84,"column":22},"end":{"row":84,"column":23},"action":"insert","lines":[";"]}],[{"start":{"row":124,"column":4},"end":{"row":124,"column":7},"action":"insert","lines":["clo"],"id":262,"ignore":true}],[{"start":{"row":124,"column":4},"end":{"row":124,"column":7},"action":"remove","lines":["clo"],"id":263,"ignore":true},{"start":{"row":124,"column":4},"end":{"row":124,"column":15},"action":"insert","lines":["closeCursor"]}],[{"start":{"row":124,"column":15},"end":{"row":124,"column":19},"action":"insert","lines":["(st)"],"id":264,"ignore":true}],[{"start":{"row":124,"column":18},"end":{"row":124,"column":20},"action":"insert","lines":["mt"],"id":265,"ignore":true}],[{"start":{"row":124,"column":20},"end":{"row":124,"column":21},"action":"insert","lines":["2"],"id":266,"ignore":true}],[{"start":{"row":124,"column":22},"end":{"row":124,"column":23},"action":"insert","lines":[";"],"id":267,"ignore":true}],[{"start":{"row":0,"column":0},"end":{"row":51,"column":5},"action":"remove","lines":["#include <stdlib.h>","#include <stdio.h>","#include <string.h>","#include <sql.h>","#include <sqlext.h>","#include \"odbc.h\"","","","int main (int argc, char **argv) {","    SQLHENV env, env2, env3;","    SQLHDBC dbc, dbc2, dbc3;","    SQLHSTMT stmt1, stmt2, stmt3;","    SQLRETURN ret; /* ODBC API return status */","    SQLINTEGER saleid;","    /*SQLDATE start, end;","    SQLCHAR isbn[256];*/","    char isbn[500];","    ","    int i;","    char buf[500];","","    /* CONNECT */","    ret = odbc_connect(&env, &dbc);","    ret = odbc_connect(&env2, &dbc2);","    ret = odbc_connect(&env3, &dbc3);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error conecting\");","        return EXIT_FAILURE;","    }","","    /* Allocate a statement handle */","    ret = SQLAllocHandle(SQL_HANDLE_STMT, dbc, &stmt1);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error allocating stmt1\");","                odbc_extract_error(\"SQLDriverConnect\", dbc, SQL_HANDLE_DBC);","","        return EXIT_FAILURE;","    }","    ret = SQLAllocHandle(SQL_HANDLE_STMT, dbc2, &stmt2);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error allocating stmt2\");","                odbc_extract_error(\"SQLDriverConnect\", dbc, SQL_HANDLE_DBC);","","        return EXIT_FAILURE;","    }","    ret = SQLAllocHandle(SQL_HANDLE_STMT, dbc3, &stmt3);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error allocating stmt3\");","                odbc_extract_error(\"SQLDriverConnect\", dbc, SQL_HANDLE_DBC);","","        return EXIT_FAILURE;","    }"],"id":268}],[{"start":{"row":0,"column":0},"end":{"row":7,"column":4},"action":"remove","lines":["","   ","   ","   ","   ","   ","   ","    "],"id":269}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":2},"action":"remove","lines":["/*"],"id":270}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":5},"action":"remove","lines":["First"],"id":271}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":[" "],"id":272}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":5},"action":"remove","lines":["query"],"id":273}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":2},"action":"remove","lines":[": "],"id":274}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":3},"action":"remove","lines":["add"],"id":275}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":[" "],"id":276}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":4},"action":"remove","lines":["sale"],"id":277}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":[" "],"id":278}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":2},"action":"remove","lines":["to"],"id":279}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":[" "],"id":280}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":4},"action":"remove","lines":["sale"],"id":281}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":[" "],"id":282}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":5},"action":"remove","lines":["table"],"id":283}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":2},"action":"remove","lines":["*/"],"id":284}],[{"start":{"row":0,"column":0},"end":{"row":2,"column":4},"action":"remove","lines":["","","    "],"id":285}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":2},"action":"remove","lines":["/*"],"id":286}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":10},"action":"remove","lines":["SQLPrepare"],"id":287}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":["("],"id":288}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":5},"action":"remove","lines":["stmt1"],"id":289}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":3},"action":"remove","lines":[", ("],"id":290}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":7},"action":"remove","lines":["SQLCHAR"],"id":291}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":2},"action":"remove","lines":["*)"],"id":292}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":[" "],"id":293}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":["\""],"id":294}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":6},"action":"remove","lines":["INSERT"],"id":295}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":[" "],"id":296}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":4},"action":"remove","lines":["INTO"],"id":297}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":[" "],"id":298}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":4},"action":"remove","lines":["sale"],"id":299}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":[" "],"id":300}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":["("],"id":301}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":9},"action":"remove","lines":["startdate"],"id":302}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":2},"action":"remove","lines":[", "],"id":303}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":7},"action":"remove","lines":["enddate"],"id":304}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":2},"action":"remove","lines":[", "],"id":305}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":8},"action":"remove","lines":["discount"],"id":306}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":2},"action":"remove","lines":[") "],"id":307}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":6},"action":"remove","lines":["VALUES"],"id":308}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":[" "],"id":309}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":3},"action":"remove","lines":["(?,"],"id":310}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":[" "],"id":311}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":2},"action":"remove","lines":["?,"],"id":312}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":[" "],"id":313}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":4},"action":"remove","lines":["?)\","],"id":314}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":[" "],"id":315}],[{"start":{"row":0,"column":0},"end":{"row":136,"column":1},"action":"remove","lines":["SQL_NTS);","    ","    start = TO_DATE(argv[2], 'YYYY-MM-DD');","    end = TO_DATE(argv[3], 'YYYY-MM-DD');","    discount = atoi(argv[1]);","    ","    SQLBindParameter(stmt1, 1, SQL_PARAM_INPUT, SQL_C_TYPE_DATE, SQL_DATE, 0, 0, &start, 0, NULL);","    SQLBindParameter(stmt1, 2, SQL_PARAM_INPUT, SQL_C_TYPE_DATE, SQL_DATE, 0, 0, &end, 0, NULL);","    SQLBindParameter(stmt1, 3, SQL_PARAM_INPUT, SQL_C_SLONG, SQL_INTEGER, 0, 0, &discount, 0, NULL);","        ","    SQLExecute(stmt1);*/","    ","","    sprintf(buf, \"INSERT INTO sale (start_date, end_date, discount) VALUES ('%s', '%s', %s)\", argv[2], argv[3], argv[1]);","    ","    ret = SQLExecDirect(stmt1, (SQLCHAR*) buf, SQL_NTS);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error executing stmt1\");","        odbc_extract_error(\"SQLDriverConnect\", dbc, SQL_HANDLE_DBC);","        return EXIT_FAILURE;","    }","    ","    ","    ","    closeCursor(stmt1);","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    /*Second query: get saleid*/","    ","    ","    ret = SQLPrepare(stmt2, (SQLCHAR*) \"SELECT saleid FROM sale ORDER BY saleid DESC\", SQL_NTS);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error preparing stmt2\");","        return EXIT_FAILURE;","    }","    ","    ret = SQLExecute(stmt2);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error executing stmt2\");","        return EXIT_FAILURE;","    }","    ","    ret = SQLGetData(stmt2, 1, SQL_C_SLONG, &saleid, sizeof(SQLINTEGER), NULL);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error getting data stmt2\");","        printf(\"%d\", (int)saleid);","        odbc_extract_error(\"SQLDriverConnect\", dbc2, SQL_HANDLE_DBC);","        return EXIT_FAILURE;","    }","","    ","    closeCursor(stmt2);","    ","    ","    ","    ","    /*Third query: add isbns to sale*/","    ","    ","    ret = SQLPrepare(stmt3, (SQLCHAR*) \"INSERT INTO sale_isbn (sale, isbn) VALUES (?, ?)\", SQL_NTS);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error preparing stmt3\");","        return EXIT_FAILURE;","    }","    ","    for (i = 4; i < argc; i++) {","        strcpy(isbn, argv[i]);","        ","        ret = SQLBindParameter(stmt3, 1, SQL_PARAM_INPUT, SQL_C_SLONG, SQL_INTEGER, 0, 0, &saleid, 0, NULL);","        if (!SQL_SUCCEEDED(ret)) {","            printf(\"Error with first parameter\");","            return EXIT_FAILURE;","        }","        ret = SQLBindParameter(stmt3, 2, SQL_PARAM_INPUT, SQL_C_CHAR, SQL_CHAR, 0, 0, (SQLCHAR *)isbn, 0, NULL);","        if (!SQL_SUCCEEDED(ret)) {","            printf(\"Error with second parameter\");","            return EXIT_FAILURE;","        }","        ","        ret = SQLExecute(stmt3);","        if (!SQL_SUCCEEDED(ret)) {","            printf(\"Error executing stmt3\");","            odbc_extract_error(\"SQLDriverConnect\", dbc3, SQL_HANDLE_DBC);","            return EXIT_FAILURE;","        }","    }","    ","    /*for (i = 4; i < argc; i++) {","        sprintf(buf, \"INSERT INTO sale_isbn (sale, isbn) VALUES (%d, %s)\", saleid, argv[i]);","    ","        SQLExecDirect(stmt3, (SQLCHAR*) buf, SQL_NTS);","    }","    */","    ","","","","    /* free up statement handle */","    ret = SQLFreeHandle(SQL_HANDLE_STMT, stmt1);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error freeing stmt1\");","        return EXIT_FAILURE;","    }","    ","    ret = SQLFreeHandle(SQL_HANDLE_STMT, stmt2);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error freeing stmt2\");","        return EXIT_FAILURE;","    }","    ","    ret = SQLFreeHandle(SQL_HANDLE_STMT, stmt3);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error freeing stmt3\");","        return EXIT_FAILURE;","    }","","    /* DISCONNECT */","    ret = odbc_disconnect(env, dbc);","    if (!SQL_SUCCEEDED(ret)) {","        return EXIT_FAILURE;","    }","","    return EXIT_SUCCESS;","}"],"id":316}],[{"start":{"row":0,"column":0},"end":{"row":191,"column":0},"action":"insert","lines":["#include <stdlib.h>","#include <stdio.h>","#include <string.h>","#include <sql.h>","#include <sqlext.h>","#include \"odbc.h\"","","","int main (int argc, char **argv) {","    SQLHENV env;","    SQLHDBC dbc;","    SQLHSTMT stmt;","    SQLRETURN ret; /* ODBC API return status */","    SQLINTEGER saleid;","    /*SQLDATE start, end;","    SQLCHAR isbn[256];*/","    char isbn[500];","    ","    int i;","    char buf[500];","","    /* CONNECT */","    ret = odbc_connect(&env, &dbc);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error conecting\");","        return EXIT_FAILURE;","    }","","    /* Allocate a statement handle */","    ret = SQLAllocHandle(SQL_HANDLE_STMT, dbc, &stmt);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error allocating stmt\");","                odbc_extract_error(\"SQLDriverConnect\", dbc, SQL_HANDLE_DBC);","","        return EXIT_FAILURE;","    }","   ","   ","   ","   ","    /*First query: add sale to sale table*/","","    /*SQLPrepare(stmt, (SQLCHAR*) \"INSERT INTO sale (startdate, enddate, discount) VALUES (?, ?, ?)\", SQL_NTS);","    ","    start = TO_DATE(argv[2], 'YYYY-MM-DD');","    end = TO_DATE(argv[3], 'YYYY-MM-DD');","    discount = atoi(argv[1]);","    ","    SQLBindParameter(stmt, 1, SQL_PARAM_INPUT, SQL_C_TYPE_DATE, SQL_DATE, 0, 0, &start, 0, NULL);","    SQLBindParameter(stmt, 2, SQL_PARAM_INPUT, SQL_C_TYPE_DATE, SQL_DATE, 0, 0, &end, 0, NULL);","    SQLBindParameter(stmt, 3, SQL_PARAM_INPUT, SQL_C_SLONG, SQL_INTEGER, 0, 0, &discount, 0, NULL);","        ","    SQLExecute(stmt);*/","    ","","    sprintf(buf, \"INSERT INTO sale (start_date, end_date, discount) VALUES ('%s', '%s', %s)\", argv[2], argv[3], argv[1]);","    ","    ret = SQLExecDirect(stmt, (SQLCHAR*) buf, SQL_NTS);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error executing stmt\");","        odbc_extract_error(\"SQLDriverConnect\", dbc, SQL_HANDLE_DBC);","        return EXIT_FAILURE;","    }","    ","","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    SQLCloseCursor(stmt);","    ","    ","    ","    /*Second query: get saleid*/","    ","    ","    /*ret = SQLPrepare(stmt, (SQLCHAR*) \"SELECT saleid FROM sale ORDER BY saleid DESC\", SQL_NTS);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error preparing stmt\");","        return EXIT_FAILURE;","    }","    ","    ret = SQLExecute(stmt);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error executing stmt\");","        return EXIT_FAILURE;","    }*/","","","    /*----------*/","    sprintf(buf, \"SELECT MAX(saleid) FROM sale\");","    ","    ret = SQLExecDirect(stmt, (SQLCHAR*) buf, SQL_NTS);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error executing stmt\");","        odbc_extract_error(\"SQLDriverConnect\", dbc, SQL_HANDLE_DBC);","        return EXIT_FAILURE;","    }","    /*-------------*/","","    ","    /*if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error getting data stmt 2\");","        printf(\"%d\", (int)saleid);","        odbc_extract_error(\"SQLDriverConnect\", dbc, SQL_HANDLE_DBC);","        return EXIT_FAILURE;","    }*/","    if (SQL_SUCCEEDED(ret = SQLFetch(stmt))) {","        ret = SQLGetData(stmt, 1, SQL_C_SLONG, &saleid, sizeof(SQLINTEGER), NULL);","    }","","    printf(\"\\nsaleid: %d\\n\", saleid);","","    ","    ","    SQLCloseCursor(stmt);","    ","    ","    ","    /*Third query: add isbns to sale*/","    ","    ","    /*ret = SQLPrepare(stmt, (SQLCHAR*) \"INSERT INTO sale_isbn (sale, isbn) VALUES (?, ?)\", SQL_NTS);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error preparing stmt\");","        return EXIT_FAILURE;","    }","    ","    for (i = 4; i < argc; i++) {","        strcpy(isbn, argv[i]);","        ","        ret = SQLBindParameter(stmt, 1, SQL_PARAM_INPUT, SQL_C_SLONG, SQL_INTEGER, 0, 0, &saleid, 0, NULL);","        if (!SQL_SUCCEEDED(ret)) {","            printf(\"Error with first parameter\");","            return EXIT_FAILURE;","        }","        ret = SQLBindParameter(stmt, 2, SQL_PARAM_INPUT, SQL_C_CHAR, SQL_CHAR, 0, 0, (SQLCHAR *)isbn, 0, NULL);","        if (!SQL_SUCCEEDED(ret)) {","            printf(\"Error with second parameter\");","            return EXIT_FAILURE;","        }","        ","        ret = SQLExecute(stmt);","        if (!SQL_SUCCEEDED(ret)) {","            printf(\"Error executing stmt 3\");","            odbc_extract_error(\"SQLDriverConnect\", dbc, SQL_HANDLE_DBC);","            return EXIT_FAILURE;","        }","    }*/","    ","    for (i = 4; i < argc; i++) {","        sprintf(buf, \"INSERT INTO sale_isbn (saleid, isbn) VALUES (%d, '%s')\", saleid, argv[i]);","    ","        ret = SQLExecDirect(stmt, (SQLCHAR*) buf, SQL_NTS);","        if (!SQL_SUCCEEDED(ret)) {","            printf(\"Error executing stmt\\n\");","            odbc_extract_error(\"SQLDriverConnect\", dbc, SQL_HANDLE_DBC);","            return EXIT_FAILURE;","        }","","        SQLCloseCursor(stmt);","    }","    ","    ","","","","    /* free up statement handle */","    ret = SQLFreeHandle(SQL_HANDLE_STMT, stmt);","    if (!SQL_SUCCEEDED(ret)) {","        printf(\"Error freeing stmt\");","        return EXIT_FAILURE;","    }","","    /* DISCONNECT */","    ret = odbc_disconnect(env, dbc);","    if (!SQL_SUCCEEDED(ret)) {","        return EXIT_FAILURE;","    }","","    return EXIT_SUCCESS;","}",""],"id":317}]]},"timestamp":1511196695734}